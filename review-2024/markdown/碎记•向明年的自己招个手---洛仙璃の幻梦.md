body:before { top: 0; left: 0; right: 0; bottom: 0; z-index: -1; content: ""; position: fixed; opacity: 0.3; } .article-item, .article-content, .bbg-comment-area, .page-content, .tag-content { background-color: white; margin-top: 30px; margin-bottom: 30px; padding: 16px; box-shadow: 0 1px 1px -2px rgb(0 0 0 / 60%), 0 2px 1px 0 rgb(0 0 0 / 36%), 0 1px 2px 1px rgb(0 0 0 / 32%); opacity: 0.8; border-radius: 6px; } .article-content { padding: 30px 4%; } .copyright\_hint { border-left-color: #5cb85c !important; border-radius: 3px; margin-bottom: 20px; padding: 1em; position: relative; border: 1px solid #eee; border-left-width: 5px; font-size: 110%; } ref { display: none; } info-hint, warning-hint, success-hint, danger-hint { display: block; padding-top: 10px; padding-bottom: 10px; padding-left: 15px; background-color: rgb(235, 234, 234); } .hint-heading { font-size: 110%; } info-hint .hint-heading { color: #0550ae; } warning-hint .hint-heading { color: #ae8105; } success-hint .hint-heading { color: #1b6e08; } danger-hint .hint-heading { color: #ae2105; } info-hint { border-left: #0550ae solid 2px; } warning-hint { border-left: #ae8105 solid 2px; } success-hint { border-left: #1b6e08 solid 2px; } danger-hint { border-left: #ae2105 solid 2px; } .article-content, .page-content { word-break: break-all; } .articlebottomnav { background-color: white; box-shadow: 0 1px 1px -2px rgb(0 0 0 / 60%), 0 2px 1px 0 rgb(0 0 0 / 36%), 0 1px 5px 0 rgb(0 0 0 / 32%); opacity: 0.8; border-radius: 6px; } .nav-item-active { border-bottom: 2px solid white; } .friend-card { box-shadow: 0 1px 1px -2px rgb(0 0 0 / 60%), 0 2px 1px 0 rgb(0 0 0 / 36%), 0 1px 5px 0 rgb(0 0 0 / 32%); border-radius: 6px; font-size: 10px !important; width: 168px; padding: 0; display: inline-flex; box-shadow: 0 2px 6px 0 rgba(0, 0, 0, .12); background: #fffefe; margin: 0; margin-bottom: 5px; margin-right: 5px; transition: box-shadow 0.2s ease; } .friend-card:hover { box-shadow: 0 3px 1px -2px rgb(0 0 0 / 60%), 0 2px 2px 0 rgb(0 0 0 / 36%), 0 1px 5px 0 rgb(0 0 0 / 32%); } .friend-card h5 { font-size: 1rem !important; text-align: center; ; } .friend-card a { text-decoration: none; font-weight: bold; } .ellipsis { display: none; } .friend-card-img { width: 100%; } .title\_that\_should\_not\_have\_underline { text-decoration: none !important; } @media (max-width: 1050px) { #empty\_friend\_book\_list { display: none; } } @media (max-width: 520px) { #article-bottom-bar { display: none; } } .article\_tag { border-radius: 40px; color: white; border: none; } .article\_tag::before { content: "#"; } .article-item-sub, .article-content-sub { color: #999; } .article-item-sub-dotted { border-bottom: 1px dashed #676161; } .small\_empty\_between\_lines { margin-top: 6px; } .small\_empty\_inline { margin-left: 2px; display: inline-block; } .article-tag-underlined { text-decoration: 1px underline; text-underline-position: under; margin-left: 8px; } nav { box-shadow: 0 3px 1px -2px rgb(0 0 0 / 20%), 0 2px 2px 0 rgb(0 0 0 / 14%), 0 1px 5px 0 rgb(0 0 0 / 12%); padding: 0 !important; } .nav-link { padding-top: 10px; padding-bottom: 10px; } .navbar-brand { padding-top: 10px; padding-bottom: 10px; font-size: 16px; font-weight: bolder; } .archive-nav-item { background-color: white !important; } @keyframes fade-in-right { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } } @-webkit-keyframes fade-in-right { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } } table, thead, tr, th, td { border: 1px solid #ddd; padding-left: 15px; padding-right: 30px; padding-top: 5px; padding-bottom: 5px; text-align: left; } blockquote { color: #666666; margin: 0; padding-left: 12px; border-left: 4px #eee solid; } hr { display: block; border: 0; border-top: 1px solid #aaa; border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; } pre, code, kbd, samp { border-radius: 4px; background-color: #f2f5f8; padding-top: 4px; padding-bottom: 4px; padding-left: 12px; padding-right: 12px; color: #0550ae; display: inline-block; word-break: break-all !important; white-space: pre-wrap; } #back\_to\_top\_btn { position: fixed; z-index: 99; right: 20px; bottom: 30px; } #back\_to\_top\_btn \* i { width: 0.8em; } #setting\_theme\_btn { position: fixed; z-index: 99; right: 20px; bottom: 80px; } #setting\_theme\_btn \* i { width: 0.8em; } body { background-color: #000000c7; } info-hint, warning-hint, success-hint, danger-hint { background-color: #000000f4; } .hint-heading { color: white!important; } .blog\_title\_jumbotron, .bg-light { background-color: #363232 !important; } .copyright\_hint { color: white; } #blog\_index\_title, #blog\_index\_subtitle, .article-content h2, .page-content h2, #article-content-html p, #page-content-html p { color: white; } .article-item, .article-content, .page-content { background-color: #000000a8 } .article-item p, .article-item-sub, .article-content-sub, #page\_order\_html, #bottom\_info\_html { color: lightgrey !important; } .card, .tag-content { background-color: black; color: white } ul, ol, li, h1, h2, h3, h4, h5, h6, th, td, .vcontent \*, #veditor { color: white } .vcontent p, .vnick, .vlink, .vmail, .vinput, .vsubmit { color: white !important } .vcontent \* { background-color: black !important; } .expand::after { background: black !important; color: white !important; } .expand::before { background: rgba(0, 0, 0, 0.5) !important } a { color: rgb(148, 187, 255); } pre, code, kbd, samp { border-radius: 4px; background-color: black !important; padding-top: 4px; padding-bottom: 4px; padding-left: 12px; padding-right: 12px; display: inline-block; color: white!important } code \* { color: white!important } .bbg-comment-area { background-color: black; color: white } .modal-header, .modal-body { background-color: rgb(139, 132, 132)!important; color: white; } .archive-nav { border-bottom: 1px solid var(--bs-dark); } .archive-nav-item { background-color: black !important; } .archive-nav-link { background-color: unset !important; border-color: var(--bs-dark) var(--bs-dark) #000 !important; }

  
  
  

## Loading...

[](javascript:toggle_theme_setting\(\);)

[](javascript:scrollTo\(0,0\);)

const image\_viewer\_dialog = new bootstrap.Modal(document.getElementById('image\_viewer\_dialog')); const theme\_setting\_dialog = new bootstrap.Modal(document.getElementById('theme\_setting\_dialog')); function toggle\_theme\_setting() { theme\_setting\_dialog.toggle(); loadThemeSettingsDialog(); } function hook\_after\_dark\_mode\_setting\_has\_been\_modified(){ const dark\_mode\_setting = document.querySelector("#selection\_dark\_mode\_setting").value; localStorage.setItem("dark\_mode\_setting", dark\_mode\_setting); reload\_dark\_mode\_setting(); } function hook\_after\_use\_serif\_font\_setting\_has\_been\_modified(){ const use\_serif\_font = document.querySelector("#use\_serif\_font").checked; localStorage.setItem("use\_serif\_font", use\_serif\_font?"true":"false"); reload\_serif\_font\_setting(); } function reload\_dark\_mode\_setting(){ switch (localStorage.getItem("dark\_mode\_setting")) { case "light\_mode": switch\_night\_mode("light"); break; case "dark\_mode": switch\_night\_mode("dark"); break; default: if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { switch\_night\_mode("dark"); } else { switch\_night\_mode("light"); } } } function loadThemeSettingsDialog() { document.getElementById("theme\_setting\_dialog\_title").innerHTML = \`<i class="fa fa-cog"></i> 主题设置\`; document.getElementById("theme\_setting\_dialog\_body").innerHTML = \`<h4><i class="fa fa-moon-o"></i> 暗色模式设置</h4> <select class="form-select" onchange="hook\_after\_dark\_mode\_setting\_has\_been\_modified()" id="selection\_dark\_mode\_setting"> <option value="auto\_switch">跟随系统</option> <option value="light\_mode">亮色模式</option> <option value="dark\_mode">暗色模式</option> </select> <br /> <h4><i class="fa fa-font"></i> 字体</h4> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="use\_serif\_font" onchange="hook\_after\_use\_serif\_font\_setting\_has\_been\_modified();"> <label class="form-check-label" for="use\_serif\_font">使用衬线字体</label> </div>\`; if(localStorage.getItem("dark\_mode\_setting") === null){ localStorage.setItem("dark\_mode\_setting", "auto\_switch"); } if(localStorage.getItem("use\_serif\_font") === null){ localStorage.setItem("use\_serif\_font", "false"); } document.getElementById("selection\_dark\_mode\_setting").value = localStorage.getItem("dark\_mode\_setting"); document.getElementById("use\_serif\_font").checked = localStorage.getItem("use\_serif\_font") === "true"; } function reload\_serif\_font\_setting(){ if(localStorage.getItem("use\_serif\_font") === "true"){ document.body.style.fontFamily = "serif"; }else{ document.body.style.fontFamily = "sans-serif"; } } markdown\_renderer = new marked.Renderer(); markdown\_renderer.heading = (text, level, raw, slugger) => { return \`<h${level} style="border-bottom: solid 1px rgba(137,137,137,0.3);padding-bottom: 4px"><a href="javascript:void(0)" class="title\_that\_should\_not\_have\_underline">##</a> ${text}</h${level}>\`; } markdown\_renderer.link = (href, title, text) => { return \`<a href="${href}" ${title === null || title === undefined || title === "" ? "" : \`title="${title}"\`} style="text-decoration: underline">${text} <i class="fa fa-external-link"></i></a>\` } var highlightFunc = function (code) { return hljs.highlightAuto(code).value; } marked.setOptions({ renderer: markdown\_renderer, highlight: highlightFunc }) baseurl = ""; String.prototype.hashCode = function () { let hash = 0, i, chr; if (this.length === 0) return hash; for (i = 0; i < this.length; i++) { chr = this.charCodeAt(i); hash = ((hash << 5) - hash) + chr; hash |= 0; } return hash; } function getTagColor(tagname) { let color\_list = \["#000099", "#330099", "#660099", "#990099", "#cc0099", "#ff0099", "#0000cc", "#3300cc", "#6600cc", "#9900cc"\]; let color\_id = parseInt(tagname.hashCode().toString().replace("-", "").slice(0, 1)); return color\_list\[color\_id\]; } window.onpopstate = function () { if (window.location.href.indexOf("#top") === -1 && window.location.href.indexOf("#reference") === -1) { window.location.reload(); } } function openImageViewer(url) { document.querySelector("#image\_viewer\_dialog\_body").innerHTML = \`<button onclick="window.open('${url.indexOf("https://") === -1 && url.indexOf("http://") === -1 ? baseurl : ""}${url}')" class="btn btn-success"><i class="fa fa-file-image-o"></i> 在新标签页打开此图像</button><br /><br /><img src="${url.indexOf("https://") === -1 && url.indexOf("http://") === -1 ? baseurl : ""}${url}" style="max-width: 100%" /><br /><br /><button onclick="window.open('${url.indexOf("https://") === -1 && url.indexOf("http://") === -1 ? baseurl : ""}${url}')" class="btn btn-success"><i class="fa fa-file-image-o"></i> 在新标签页打开此图像</button><button onclick="image\_viewer\_dialog.hide()" class="btn btn-primary"><i class="fa fa-times"></i> 关闭此对话框</button>\`; image\_viewer\_dialog.toggle(); } function content\_decrypt(content, password) { return sjcl.decrypt(password, content); } currentArticleListPageOrder = 1; //这个变量表示目前在显示文章列表中的第几页，是从1开始数的 success\_locate\_article\_id = false; success\_locate\_page\_id = false; function detect\_whether\_ui\_load\_finished() { if (bootstrap\_css\_import\_finished === true && content\_load\_finished === true) { document.getElementById("root").setAttribute("style", ""); document.getElementById("loading").setAttribute("style", "display:none"); } } function copy\_full\_article\_to\_clipboard() { navigator.clipboard.writeText(document.querySelector("#article-content-html").innerText); document.getElementById("copy\_to\_clipboard\_button").innerHTML = \`<i class="fa fa-check"></i> 已复制！\`; } bootstrap\_css\_import\_finished = false; content\_load\_finished = false; highlight\_css\_import\_finished = false; let langdata = { "ARCHIVE\_AND\_TAGS": { "简体中文": "归档和标签", "English": "Archive and tags", "日本語": "アーカイブとタグ" }, "ARTICLE\_LIST": { "简体中文": "文章列表", "English": "Article List", "日本語": "記事一覧" }, "ARTICLE\_CREATEDAT": { "简体中文": "此文章编写于", "English": "This article is written at ", "日本語": "作成日" }, "LASTMODIFIEDAT": { "简体中文": "最近修改于", "English": "Last modified at ", "日本語": "修正日" }, "TAGS": { "简体中文": "标签", "English": "Tags: ", "日本語": "タグ" }, "COMMENT\_UNAVAILABLE\_DUE\_TO\_PREVIEW": { "简体中文": "由于你目前正在预览环境之中，评论功能暂时被禁用了。当你的站点被从互联网访问时，评论系统会正常地显示在这里。", "English": "Comment function banned because you are now in the preview environment. When the site is visited from the Internet, the comment system will be available here.", "日本語": "現在プレビュー環境のため、コメント機能が禁止されています。インターネットからサイトにアクセスすると、ここにコメントシステムが表示されます。" }, "FRIEND\_BOOK": { "简体中文": "友人帐", "English": "Friend book", "日本語": "友人帳" }, "COPYRIGHT\_HINT": { "简体中文": "版权声明", "English": "About the copyright of the article", "日本語": "記事の著作権について" }, "PREVIOUS\_POST": { "简体中文": "上一篇文章", "English": "Previous post", "日本語": "前の記事へ" }, "NEXT\_POST": { "简体中文": "下一篇文章", "English": "Next post", "日本語": "次の記事へ" }, "NOTHING": { "简体中文": "没有了", "English": "nothing", "日本語": "記事が存在しない" }, "COPYRIGHT\_RESERVED": { "简体中文": "除特别声明外，本博客上的内容由博主保留所有权利，进行转载前需先获得博主同意。", "English": "Unless otherwise stated, the content on this blog is reserved by the blogger, and the blogger's consent must be obtained before reprinting.", "日本語": "特別な記載がない限り、このブログ内の記事はブロガーの所有物であり、転載にはブロガーの同意が必要です。" }, "COPYRIGHT\_CC\_BY\_NC\_SA\_FOUR\_DOT\_ZERO": { "简体中文": "除特别声明外，本博客上的内容采用 <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh' target='\_blank'>CC BY-NC-SA 4.0 许可协议</a> 授权。转载请注明出处！", "English": "Unless otherwise stated, the content on this blog is licensed under the <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en' target='\_blank'>CC BY-NC-SA 4.0 license</a>. Please indicate the source when reprinting!", "日本語": "特別な記載がない限り、このブログ内の記事は<a href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja' target='\_blank'>CC BY-NC-SA 4.0ライセンス</a>を使用しています。転載の際は出典を明記してください！" }, "COPYRIGHT\_UNLICENSED": { "简体中文": "除特别声明外，本博客上的内容属于公有领域，这意味着你可以不受限制地使用和加工它们。", "English": "Unless otherwise stated, the content on this blog is in the public domain, which means you can use and process it without restriction.", "日本語": "特別な記載がない限り、このブログ内の記事はパブリックドメインであり、制限なく使用・加工できます。" }, "SEARCH\_SOMETHING": { "简体中文": "在站点内搜索", "English": "Search something...", "日本語": "検索..." }, "START\_SEARCH": { "简体中文": "开始搜索", "English": "Search", "日本語": "検索" }, "KEYWORD": { "简体中文": "关键词", "English": "Keyword", "日本語": "キーワード" }, "SEARCH\_RESULT": { "简体中文": "搜索结果", "English": "Results", "日本語": "検索結果" }, "REFERENCE": { "简体中文": "参考", "English": "References", "日本語": "References" }, "INFO": { "简体中文": "提示", "English": "Hint", "日本語": "Hint" }, "WARNING": { "简体中文": "注意", "English": "Warning", "日本語": "Warning" }, "SUCCESS": { "简体中文": "成功", "English": "Success", "日本語": "Success" }, "DANGER": { "简体中文": "危险", "English": "Danger", "日本語": "Danger" }, "COULD\_NOT\_FIND\_RESULT": { "简体中文": "未找到结果", "English": "Could not find a result", "日本語": "検索結果はありません" } } function render\_ref\_tags() { let ref\_tags = \[\]; let current\_number = 1; for (let i = 0; i < document.getElementsByTagName("ref").length; i++) { let ref = document.getElementsByTagName("ref")\[i\]; ref\_tags.push({ "ref\_name": ref.innerText, "ref\_id": current\_number, "ref\_has\_target": ref.getAttribute("url") !== undefined && ref.getAttribute("url") !== null && ref.getAttribute("url") !== "" }); document.getElementsByTagName("ref")\[i\].innerHTML = \`<sup style="font-size: 14px;"><a href="#reference\_list\_id\_${current\_number}">\[${current\_number}\]</a></sup>\`; document.getElementsByTagName("ref")\[i\].setAttribute("style", "display:inline"); document.getElementsByTagName("ref")\[i\].setAttribute("id", \`reference\_id\_${current\_number}\`); if (ref\_tags\[ref\_tags.length - 1\].ref\_has\_target === true) { ref\_tags\[ref\_tags.length - 1\].ref\_target = ref.getAttribute("url"); } current\_number += 1; } if (ref\_tags.length !== 0) { ref\_html = \`<div id="content\_reference\_list"><h3>${langdata.REFERENCE\[lang\_name\]}</h3><hr />\`; for (const ref of ref\_tags) { ref\_html += \`<div id="reference\_list\_id\_${ref.ref\_id}"><b>${ref.ref\_id}.<a href="#reference\_id\_${ref.ref\_id}">^</a></b>&nbsp; ${ref.ref\_has\_target === false ? ref.ref\_name : \`<a href="${ref.ref\_target}" target="\_blank">${ref.ref\_name}</a>\`} </div>\`; } ref\_html += \`</div>\`; document.getElementById("article-content-html").insertAdjacentHTML("beforeend", ref\_html); } } function render\_hint\_tags() { for (let i = 0; i < document.getElementsByTagName("info-hint").length; i++) { document.getElementsByTagName("info-hint")\[i\].innerHTML = \`<span class="hint-heading"><i class="fa fa-info-circle"></i> ${langdata\["INFO"\]\[lang\_name\]} </span><br />\` + document.getElementsByTagName("info-hint")\[i\].innerHTML; } for (let i = 0; i < document.getElementsByTagName("warning-hint").length; i++) { document.getElementsByTagName("warning-hint")\[i\].innerHTML = \`<span class="hint-heading"><i class="fa fa-exclamation-circle"></i> ${langdata\["WARNING"\]\[lang\_name\]} </span><br />\` + document.getElementsByTagName("warning-hint")\[i\].innerHTML; } for (let i = 0; i < document.getElementsByTagName("danger-hint").length; i++) { document.getElementsByTagName("danger-hint")\[i\].innerHTML = \`<span class="hint-heading"><i class="fa fa-exclamation-triangle"></i> ${langdata\["DANGER"\]\[lang\_name\]} </span><br />\` + document.getElementsByTagName("danger-hint")\[i\].innerHTML; } for (let i = 0; i < document.getElementsByTagName("success-hint").length; i++) { document.getElementsByTagName("success-hint")\[i\].innerHTML = \`<span class="hint-heading"><i class="fa fa-check-circle-o"></i> ${langdata\["SUCCESS"\]\[lang\_name\]} </span><br />\` + document.getElementsByTagName("success-hint")\[i\].innerHTML; } } function preview\_env\_public\_comment\_fix() { if (window.location.href.indexOf("localhost") !== -1 || window.location.href.indexOf("127.0.0.1") !== -1) { if (blog\["全局评论设置"\]\["valine设置"\]\["是否使用bbg公共评论服务"\]) { document.getElementById("vcomments").innerHTML = \`<p style="color:red;">${langdata\["COMMENT\_UNAVAILABLE\_DUE\_TO\_PREVIEW"\]\[lang\_name\]}</p>\`; } } } function resetPage() { document.querySelector("#root").innerHTML = ""; console.log("reset ok"); } function start\_search() { let keyword = document.getElementById("search\_keyword").value.toLowerCase(); let totalSearchResultNumber = 0; document.getElementById("search\_dialog\_results").innerHTML = \`<br /><hr />\`; if (history.state.type === "article" || history.state.type === "short\_article") { // 在文章内检索 let articleContent = document.querySelector("#article-content-html").innerText.toLowerCase(); if (articleContent.indexOf(keyword) !== -1) { document.getElementById("search\_dialog\_results").insertAdjacentHTML("afterend", \`<h3>在当前文章中找到了一处结果</h3><div class="card" style="padding:20px"><a href="javascript:void(0)" data-bs-dismiss="modal" onclick="return false;"><h5>${document.getElementById("current\_article\_title").innerText}</h5></a><p class="search\_result\_detail">${articleContent.substring(articleContent.indexOf(keyword) - 20, articleContent.indexOf(keyword) + 20)}</p></div>\`); totalSearchResultNumber++; } } document.getElementById("search\_dialog\_results").insertAdjacentHTML("beforeend", \`<br /><h3>全部搜索结果</h3><br />\`); for (let i = 0; i < blog\["文章列表"\].length; i++) { const articleTitle = blog\["文章列表"\]\[i\]\["文章标题"\].toLowerCase(); const articleAbstract = blog\["文章列表"\]\[i\]\["摘要"\].toLowerCase(); if (articleTitle.indexOf(keyword) !== -1 || articleAbstract.indexOf(keyword) !== -1) { if (blog\["文章列表"\]\[i\]\["是否隐藏"\] === false) { document.getElementById("search\_dialog\_results").insertAdjacentHTML("beforeend", \`<div class="card" style="padding:20px"><a href="javascript:void(0)" data-bs-dismiss="modal" onclick="enter\_article(${i});return false;"><h5>${blog\["文章列表"\]\[i\]\["文章标题"\]}</h5></a><p class="search\_result\_detail">${blog\["文章列表"\]\[i\]\["摘要"\]}</p></div>\`); totalSearchResultNumber++; } } } if (totalSearchResultNumber === 0) { document.getElementById("search\_dialog\_results").insertAdjacentHTML("beforeend", \`<br /><p>${langdata\["COULD\_NOT\_FIND\_RESULT"\]\[lang\_name\]}</p>\`); } else { for (let i = 0; i < document.getElementsByClassName("search\_result\_detail").length; i++) { document.getElementsByClassName("search\_result\_detail")\[i\].innerHTML = document.getElementsByClassName("search\_result\_detail")\[i\].innerHTML.replaceAll(keyword, \`<span style="background-color:yellow">${keyword}</span>\`) } } } function start\_search\_dialog() { const dialog = new bootstrap.Modal(document.getElementById('search\_dialog')) dialog.toggle(); document.getElementById("search\_dialog\_title").innerHTML = langdata\["SEARCH\_SOMETHING"\]\[lang\_name\]; document.getElementById("search\_dialog\_body").innerHTML = \`<div class="row g-2"><div class="col-auto"><input class="form-control" id="search\_keyword" placeholder="${langdata\["KEYWORD"\]\[lang\_name\]}" autocomplete="off" autocapitalize="off" spellcheck="false"></div><div class="col-auto"><button class="btn btn-primary" onclick="start\_search()"> ${langdata\["START\_SEARCH"\]\[lang\_name\]}</button></div></div><div id="search\_dialog\_results"></div>\`; document.getElementById("search\_keyword").focus(); document.getElementById("search\_keyword").addEventListener('input', start\_search); } function render\_nav(isIndexPage) { //todo: fix router let nav\_base = \`<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light" id="navbar"> <div class="container-fluid"> <a class="navbar-brand" id="navbar\_title" href="./index.html" onclick="currentArticleListPageOrder=1;enter\_indexPage();return false;">${blog\["博客标题"\]}</a> <button class="navbar-toggler" style="border:none;color:white;margin-left:2px" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <i class="fa fa-bars"></i> </button> <div class="collapse navbar-collapse" id="navbarSupportedContent"> <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="navbar\_items"> <li class="nav-item" id="navbar\_article\_list"> <a class="nav-link" href="./index.html?type=internal&function=article\_list" onclick="currentArticleListPageOrder=1;enter\_indexPage();return false;">${langdata\["ARTICLE\_LIST"\]\[lang\_name\]}</a> </li> <li class="nav-item" id="navbar\_archive\_and\_tags"> <a class="nav-link" href="./index.html?type=internal&function=archive\_and\_tags" onclick="enter\_archive\_and\_tags();return false;">${langdata\["ARCHIVE\_AND\_TAGS"\]\[lang\_name\]}</a> </li> </ul> <div class="d-flex" role="search"> <button class="btn btn-outline-${blog\["搜索按钮边框颜色设置为暗色"\] ? "dark" : "light"}" onclick="start\_search\_dialog()" style="color: ${blog\["全局主题设置"\]\["标题栏文字颜色"\]}"><i class="fa fa-search"></i> ${langdata\["SEARCH\_SOMETHING"\]\[lang\_name\]}</button> </div> <div class="d-flex"> <div style="display:block;padding:2px"></div> </div> </div> </div> </nav>\`; document.querySelector("#root").insertAdjacentHTML("beforeend", nav\_base); document .querySelector("#navbar\_title") .setAttribute( "style", "color:" + blog\["全局主题设置"\]\["标题栏文字颜色"\] + "!important" ); if (blog\["页面列表"\].length === 0) { } else { for (let i = 0; i < blog\["页面列表"\].length; i++) { if (blog\["页面列表"\]\[i\]\["是否显示在菜单中"\]) { document.querySelector("#navbar\_items").insertAdjacentHTML("beforeend", \`<li class="nav-item" id="navbar\_page\_${i}"><a class="nav-link" href="./index.html?type=page&filename=${blog\["页面列表"\]\[i\]\["文件名"\]}" onclick="enter\_page(${i});return false;">${blog\["页面列表"\]\[i\]\["若显示在菜单中，则在菜单中显示为"\]}</a></li>\`); } } } if (blog\["启用内建友人帐页面"\] === true) { document.querySelector("#navbar\_items").insertAdjacentHTML("beforeend", \`<li class="nav-item" id="navbar\_friendbook"><a class="nav-link" href="./index.html?type=internal&function=friendbook" onclick="enter\_friend\_book();return false;">${langdata.FRIEND\_BOOK\[lang\_name\]}</a></li>\`); } if (blog\["菜单中的外部链接"\].length === 0) { } else { for (let i = 0; i < blog\["菜单中的外部链接"\].length; i++) { if (blog\["菜单中的外部链接"\]\[i\]\["是否在新标签页打开"\]) { document.querySelector("#navbar\_items").insertAdjacentHTML("beforeend", \`<li class="nav-item"><a class="nav-link" target="\_blank" href="${blog\["菜单中的外部链接"\]\[i\]\["url"\]}">${blog\["菜单中的外部链接"\]\[i\]\["显示名称"\]}</a></li>\`); } else { document.querySelector("#navbar\_items").insertAdjacentHTML("beforeend", \`<li class="nav-item"><a class="nav-link" href="${blog\["菜单中的外部链接"\]\[i\]\["url"\]}">${blog\["菜单中的外部链接"\]\[i\]\["显示名称"\]}</a></li>\`); } } } document .querySelector("#navbar") .setAttribute( "style", "background-color:" + blog\["全局主题设置"\]\["标题栏背景颜色"\] + "!important" ); for ( let i = 0; i < document.getElementsByClassName("nav-link").length; i++ ) { document .getElementsByClassName("nav-link") \[i\].setAttribute( "style", "color:" + blog\["全局主题设置"\]\["标题栏文字颜色"\] + "!important" ); } } function render\_container() { document.querySelector( "#root" ).insertAdjacentHTML("beforeend", \`<div id="container" class="container" style="animation: fade-in-right alternate 0.8s;"></div>\`); } function render\_index\_title\_info() { document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 id="blog\_index\_title" style="font-size:50px;">${blog\["博客标题"\]}</h1><p id="blog\_index\_subtitle" style="font-size:20px;">${blog\["博客描述（副标题）"\]}</p></div><br /><br /></div>\`); if (blog\["启用网站公告"\] === true) { document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="article-item"><h3><i class="fa fa-bullhorn" aria-hidden="true"></i> 网站公告</h3>${blog\["网站公告"\]}</div>\`) } } function changeArticleListPageOrderTo(page\_order) { currentArticleListPageOrder = page\_order; enter\_indexPage(); } function convertTimeStampToLocalTime(timestamp) { if(blog\["网站语言"\] === "简体中文"){ let dateObj = new Date(timestamp); return dateObj.getFullYear() + "年" + (dateObj.getMonth() + 1) + "月" + dateObj.getDate() + "日 " + ((dateObj.getHours() <= 12) ? "上午" : "下午") + ((dateObj.getHours() <= 12) ? dateObj.getHours() : (dateObj.getHours() - 12)) + ":" + ((dateObj.getMinutes().toString().length === 1) ? "0" : "") + dateObj.getMinutes(); }else if(blog\["网站语言"\] === "English"){ return new Date(timestamp).toLocaleString("en-US", {hour12: true}); }else if(blog\["网站语言"\] === "日本語"){ return new Date(timestamp).toLocaleString("ja-JP", {hour12: true}); }else{ return new Date(timestamp).toISOString(); } } function render\_article\_list() { for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["是否置顶"\] && currentArticleListPageOrder === 1) { document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="article-item" id="article-item-${i}"><div class="article-item-sub"><i class="fa fa-thumb-tack"></i> 置顶文章</div><h2><a class="underline-animation" href="./index.html?type=article&filename=${blog\["文章列表"\]\[i\]\["文件名"\]}" onclick="enter\_article(${i});return false;">${blog\["文章列表"\]\[i\]\["文章标题"\]}</a></h2></div>\`); } } // 注意：这里的两个 order 变量都是从1开始数的 let currentArticleListFromOrder = (currentArticleListPageOrder - 1) \* blog\["文章列表中每页的文章数为"\] + 1; let currentArticleListToOrder = currentArticleListPageOrder \* blog\["文章列表中每页的文章数为"\]; for (let i = currentArticleListFromOrder - 1; i < currentArticleListToOrder && i < visible\_articles.length; i++) { if ( visible\_articles\[i\]\["是否隐藏"\] || visible\_articles\[i\]\["是否置顶"\] ) { } else { document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="article-item" id="article-item-${i}"><h2><a class="underline-animation" href="./index.html?type=article&filename=${visible\_articles\[i\]\["文件名"\]}" onclick="enter\_article(${i}, true);return false;">${visible\_articles\[i\]\["文章标题"\]}</a></h2></div>\`); document.querySelector("#article-item-" + i).insertAdjacentHTML("beforeend", \`<div class="article-item-sub" id="article-item-sub-${i}"></div>\`); document.querySelector("#article-item-sub-" + i).insertAdjacentHTML("beforeend", \`<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]} <span class="article-item-sub-dotted" title="${new Date(visible\_articles\[i\]\["创建时间（时间戳）"\]).toISOString()}">${convertTimeStampToLocalTime(visible\_articles\[i\]\["创建时间（时间戳）"\])}</span> <div class="small\_empty\_inline"></div> | <div class="small\_empty\_inline"></div> <i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]} <span class="article-item-sub-dotted" title="${new Date(visible\_articles\[i\]\["修改时间（时间戳）"\]).toISOString()}">${convertTimeStampToLocalTime(visible\_articles\[i\]\["修改时间（时间戳）"\])}</span> <br /><div class="small\_empty\_between\_lines"></div>\`); if (visible\_articles\[i\]\["标签"\].length === 0) { } else { document.querySelector("#article-item-sub-" + i).insertAdjacentHTML("beforeend", \`<i class="fa fa-tags"></i> ${langdata\["TAGS"\]\[lang\_name\]}\`); for (let k = 0; k < visible\_articles\[i\]\["标签"\].length; k++) { document.querySelector("#article-item-sub-" + i).insertAdjacentHTML("beforeend", \`<a class="article-tag-underlined" style="color: ${getTagColor(visible\_articles\[i\]\["标签"\]\[k\])}" href="./index.html?type=internal&function=tag&argument=${visible\_articles\[i\]\["标签"\]\[k\]}" onclick="enter\_tag('${visible\_articles\[i\]\["标签"\]\[k\]}');return false;">#${visible\_articles\[i\]\["标签"\]\[k\]}</a>\`); } } document.querySelector("#article-item-" + i).insertAdjacentHTML("beforeend", \`<br /><p>${visible\_articles\[i\]\["摘要"\]}</p>\`); } } if (articleListPageLength !== 1) { for (let i = 0; i < articleListPageLength; i++) { if (i + 1 === currentArticleListPageOrder) { document.getElementById("container").insertAdjacentHTML("beforeend", \`<button class="btn btn-secondary btn-sm" onclick="changeArticleListPageOrderTo(${i + 1})">${i + 1}</button> \`); } else { document.getElementById("container").insertAdjacentHTML("beforeend", \`<button class="btn btn-link btn-sm" onclick="changeArticleListPageOrderTo(${i + 1})">${i + 1}</button>\`); } } document.getElementById("container").insertAdjacentHTML("beforeend", \`<br /><br /><p style="color:grey;" id="page\_order\_html">你当前正在浏览文章列表的第${currentArticleListPageOrder}页（共${articleListPageLength}页）。</p>\`); } } function render\_friend\_book\_list() { for (let i = 0; i < blog\["友人帐"\].length; i++) { render\_friend\_book\_friend("friend\_book\_list", blog\["友人帐"\]\[i\]\["名称"\], blog\["友人帐"\]\[i\]\["链接"\], blog\["友人帐"\]\[i\]\["图标"\], blog\["友人帐"\]\[i\]\["简介"\]) } } function render\_article\_content(article\_id, visible) { if (blog\["Markdown渲染配置"\]\["使用markdown文件所在目录作为baseurl"\]) { baseurl = "/data/articles/" } if (blog\["启用网站公告"\] === true && blog\["网站公告仅在首页显示"\] === false) { document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="alert alert-primary"><i class="fa fa-bullhorn" aria-hidden="true"></i> 公告： ${blog\["网站公告"\]}</div>\`); } // test document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light" style="opacity: 0.9"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 id="current\_article\_title" style="font-size:50px;">${blog\["文章列表"\]\[article\_id\]\["文章标题"\]}</h1><div id="article-content-sub" class="article-content-sub"><i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]} <span class="article-item-sub-dotted" title="${new Date(blog\["文章列表"\]\[article\_id\]\["创建时间（时间戳）"\]).toISOString()}">${convertTimeStampToLocalTime(blog\["文章列表"\]\[article\_id\]\["创建时间（时间戳）"\])}</span> <div class="small\_empty\_inline"></div> | <div class="small\_empty\_inline"></div> <i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]} <span class="article-item-sub-dotted" title="${new Date(blog\["文章列表"\]\[article\_id\]\["修改时间（时间戳）"\]).toISOString()}">${convertTimeStampToLocalTime(blog\["文章列表"\]\[article\_id\]\["修改时间（时间戳）"\])}</span> <br /><div class="small\_empty\_between\_lines"></div></div></div><br /></div>\`); // start if (blog\["文章列表"\]\[article\_id\]\["标签"\].length === 0) { } else { document.querySelector("#article-content-sub").insertAdjacentHTML("beforeend", \`<i class="fa fa-tags"></i> ${langdata\["TAGS"\]\[lang\_name\]}\`); for (let k = 0; k < blog\["文章列表"\]\[article\_id\]\["标签"\].length; k++) { document.querySelector("#article-content-sub").insertAdjacentHTML("beforeend", \`<a class="article-tag-underlined" style="color: ${getTagColor(blog\["文章列表"\]\[article\_id\]\["标签"\]\[k\])}" href="./index.html?type=internal&function=tag&argument=${blog\["文章列表"\]\[article\_id\]\["标签"\]\[k\]}" onclick="enter\_tag('${blog\["文章列表"\]\[article\_id\]\["标签"\]\[k\]}');return false;">#${blog\["文章列表"\]\[article\_id\]\["标签"\]\[k\]}</a>\`); } } // end document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="article-content" id="article-content"><div id="loading\_article\_or\_page\_content"><div class="spinner-border text-primary" role="status"></div></div></div>\`); document.querySelector( "#article-content-sub" ).insertAdjacentHTML("beforeend", \`<br /><br />\`); axios .get( "./data/articles/" + blog\["文章列表"\]\[article\_id\]\["文件名"\] + "?timestamp=" + Date.parse(new Date()) ) .then(function (response) { document.getElementById("loading\_article\_or\_page\_content").remove(); if (blog\["文章列表"\]\[article\_id\]\["是否加密"\]) { document.querySelector("#article-content").insertAdjacentHTML("beforeend", \`<div id="article-content-html"><div id="passwordRequiredArea">此文章被密码加密。请输入密码以查看文章内容。<div class="mb-3"> <label class="form-label"><i class="fa fa-password"></i> 请输入密码</label> <input class="form-control" placeholder="请输入密码" value="" id="article\_password\_modal\_value"> <button class="btn btn-outline-primary" id="viewContentAfterInputPasswordBtn">查看内容</button> </div></div></div>\`); document.getElementById("viewContentAfterInputPasswordBtn").onclick = () => { try { const decryptedContent = content\_decrypt(JSON.stringify(response.data), document.getElementById("article\_password\_modal\_value").value); document.getElementById("passwordRequiredArea").innerHTML = marked.parse(decryptedContent); } catch (error) { alert("密码错误。"); } } } else { if(blog\["文章列表"\]\[article\_id\]\["ai生成的摘要"\] !== null && blog\["文章列表"\]\[article\_id\]\["ai生成的摘要"\] !== undefined && blog\["文章列表"\]\[article\_id\]\["ai生成的摘要"\] !== ""){ document.querySelector("#article-content").insertAdjacentHTML("beforeend", \`<div class="alert alert-primary" style="padding-left:40px;padding-right:40px;padding-top:15px;padding-bottom:5px; border-radius: 30px; margin-bottom:30px!important" role="alert"> <h4 class="alert-heading"><i class="fa fa-newspaper-o" style="margin-right:4px"></i> AI 生成的摘要 <span style="display:inline-block; margin-right: 4px"></span> <button class="btn btn-sm btn-outline-secondary" style="font-size: 12px" disabled>此摘要并非实时生成</button></h4> <div style="margin-top:17px"></div> <p>${blog\["文章列表"\]\[article\_id\]\["ai生成的摘要"\]}</p> </div>\`); } document.querySelector("#article-content").insertAdjacentHTML("beforeend", \`<div id="article-content-html">${marked.parse(response.data)}</div>\`); } render\_ref\_tags(); render\_hint\_tags(); renderMathInElement(document.getElementById("article-content-html"), { delimiters: \[ { left: '$$$', right: '$$$', display: true }, { left: '$$', right: '$$', display: true }, { left: '$', right: '$', display: false }, \], throwOnError: false }); // test if (blog\["提供文章文件下载"\] || blog\["提供复制全文到剪贴板的选项"\]) { document.getElementById("article-content").insertAdjacentHTML("beforeend", \`<br /><div style="float:right;font-size:18px" id="article-bottom-bar"></div><br />\`) } if (blog\["提供文章文件下载"\]) { document.getElementById("article-bottom-bar").insertAdjacentHTML("beforeend", \`<a class="btn btn-outline-primary" href="./data/articles/${blog\["文章列表"\]\[article\_id\]\["文件名"\]}" download="${blog\["文章列表"\]\[article\_id\]\["文章标题"\]}.md"><i class="fa fa-download"></i> 将该文章下载到你的计算机上</a> \`); } if (blog\["提供复制全文到剪贴板的选项"\]) { document.getElementById("article-bottom-bar").insertAdjacentHTML("beforeend", \`<a class="btn btn-outline-primary" id="copy\_to\_clipboard\_button" onclick="copy\_full\_article\_to\_clipboard();"><i class="fa fa-clipboard"></i> 复制全文到剪贴板</a>\`); } if (blog\["不使用全站内容授权协议"\] === false) { document.querySelector( "#article-content" ).insertAdjacentHTML("beforeend", \`<br /><div class="copyright\_hint"><h5>${langdata.COPYRIGHT\_HINT\[lang\_name\]}</h5><p class="mb-0">${blogContentLicenseText}</p></div>\`); } if (blog\["文章页面显示上一篇下一篇文章导航按钮"\]) { if (article\_id === 0 && blog\["文章列表"\]\[article\_id + 1\] != undefined && blog\["文章列表"\]\[article\_id + 1\]\["是否隐藏"\] !== true) { document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="row"><div class="col"><div class="card articlebottomnav" style="float:left;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted"><i class="fa fa-arrow-left"></i> ${langdata.PREVIOUS\_POST\[lang\_name\]}</h6><h5 class="card-title"><a href="./index.html?type=article&filename=${blog\["文章列表"\]\[article\_id + 1\]\["文件名"\]}" onclick="enter\_article(${article\_id + 1});return false;">${blog\["文章列表"\]\[article\_id + 1\]\["文章标题"\]}</a></h5></div></div></div><div class="col"><div class="card articlebottomnav" style="float:right;text-align:right;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">${langdata.NEXT\_POST\[lang\_name\]} <i class="fa fa-arrow-right"></i></h6><h5 class="card-title">${langdata.NOTHING\[lang\_name\]}</h5></div></div></div></div>\`) } if (article\_id === 0 && blog\["文章列表"\]\[article\_id + 1\] == undefined) { document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="row"><div class="col"><div class="card articlebottomnav" style="float:left;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted"><i class="fa fa-arrow-left"></i> ${langdata.PREVIOUS\_POST\[lang\_name\]}</h6><h5 class="card-title">${langdata.NOTHING\[lang\_name\]}</h5></div></div></div><div class="col"><div class="card articlebottomnav" style="float:right;text-align:right;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">${langdata.NEXT\_POST\[lang\_name\]} <i class="fa fa-arrow-right"></i></h6><h5 class="card-title">${langdata.NOTHING\[lang\_name\]}</h5></div></div></div></div>\`) } if (article\_id !== 0 && blog\["文章列表"\]\[article\_id + 1\] == undefined && blog\["文章列表"\]\[article\_id - 1\]\["是否隐藏"\] !== true) { document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="row"><div class="col"><div class="card articlebottomnav" style="float:left;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted"><i class="fa fa-arrow-left"></i> ${langdata.PREVIOUS\_POST\[lang\_name\]}</h6><h5 class="card-title">${langdata.NOTHING\[lang\_name\]}</h5></div></div></div><div class="col"><div class="card articlebottomnav" style="float:right;text-align:right;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">${langdata.NEXT\_POST\[lang\_name\]} <i class="fa fa-arrow-right"></i></h6><h5 class="card-title"><a href="./index.html?type=article&filename=${blog\["文章列表"\]\[article\_id - 1\]\["文件名"\]}" onclick="enter\_article(${article\_id - 1});return false;">${blog\["文章列表"\]\[article\_id - 1\]\["文章标题"\]}</a></h5></div></div></div></div>\` ) } if (article\_id !== 0 && blog\["文章列表"\]\[article\_id + 1\] != undefined && blog\["文章列表"\]\[article\_id + 1\]\["是否隐藏"\] !== true && blog\["文章列表"\]\[article\_id - 1\]\["是否隐藏"\] !== true) { document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="row"><div class="col"><div class="card articlebottomnav" style="float:left;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted"><i class="fa fa-arrow-left"></i> ${langdata.PREVIOUS\_POST\[lang\_name\]}</h6><h5 class="card-title"><a href="./index.html?type=article&filename=${blog\["文章列表"\]\[article\_id + 1\]\["文件名"\]}" onclick="enter\_article(${article\_id + 1});return false;">${blog\["文章列表"\]\[article\_id + 1\]\["文章标题"\]}</a></h5></div></div></div><div class="col"><div class="card articlebottomnav" style="float:right;text-align:right;width:100%"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">${langdata.NEXT\_POST\[lang\_name\]} <i class="fa fa-arrow-right"></i></h6><h5 class="card-title"><a href="./index.html?type=article&filename=${blog\["文章列表"\]\[article\_id - 1\]\["标识符"\]}" onclick="enter\_article(${article\_id - 1});return false;">${blog\["文章列表"\]\[article\_id - 1\]\["文章标题"\]}</a></h5></div></div></div></div>\`) } } if (visible) blog\["文章列表"\] = visible\_articles; // This is needed, though idk why??? if ( (blog\["全局评论设置"\]\["启用valine评论"\] || blog\["全局评论设置"\]\["启用disqus评论"\] || blog\["全局评论设置"\]\["启用waline评论"\]) && blog\["文章列表"\]\[article\_id\]\["启用评论"\] ) { document.querySelector( "#container" ).insertAdjacentHTML("beforeend", \`<div class="bbg-comment-area"><h3><i class="fa fa-comments-o"></i> 在此文章 《${blog\["文章列表"\]\[article\_id\]\["文章标题"\]}》 下评论：</h3><br /><div id="vcomments"></div><div id="disqus\_thread"></div></div>\`); } render\_bottom\_information(); execute\_custom\_js(); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); if ( blog\["全局评论设置"\]\["启用valine评论"\] && blog\["文章列表"\]\[article\_id\]\["启用评论"\] ) { new Valine({ el: "#vcomments", appId: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appid"\], appKey: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appkey"\], path: comment\_authcode + "article=" + blog\["文章列表"\]\[article\_id\]\["文件名"\], }); preview\_env\_public\_comment\_fix(); } if (blog\["全局评论设置"\]\["启用disqus评论"\] && blog\["文章列表"\]\[article\_id\]\["启用评论"\]) { let disqus\_config = function () { this.page.identifier = "article=" + blog\["文章列表"\]\[article\_id\]\["文件名"\]; }; (function () { let d = document, s = d.createElement('script'); s.src = \`https://${blog\["全局评论设置"\]\["disqus设置"\]\["shortname"\]}.disqus.com/embed.js\`; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); } if ( blog\["全局评论设置"\]\["启用waline评论"\] && blog\["文章列表"\]\[article\_id\]\["启用评论"\] ) { Waline.init({ el: "#vcomments", serverURL: blog\["全局评论设置"\]\["waline设置"\]\["serverurl"\], path: "article=" + blog\["文章列表"\]\[article\_id\]\["文件名"\], turnstileKey: blog\["全局评论设置"\]\["waline设置"\]\["turnstileKey"\], }); } }) } function render\_friend\_book\_friend(listid, name, url, icon, description) { document.getElementById(listid).insertAdjacentHTML("beforeend", \`<div class="card friend-card"><img src="${icon}" class="friend-card-img" onerror="this.src='https://images.placeholders.dev/?width=500&height=500&textColor=%23ddd&bgColor=%23ddd'"><div class="card-body"><h5 class="card-title"><a target="\_blank" href="${url}">${name}</a></h5><p class="card-text ellipsis">${description}</p></div></div>\`); } function render\_friend\_book() { document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 style="font-size:50px;">${langdata.FRIEND\_BOOK\[lang\_name\]}</h1></div><br /><br /></div>\`); document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="page-content"><p>${blog\["友人帐页面附加信息"\]}</p><div id="friend\_book\_list"></div></div>\`); if (blog\["友人帐来自json文件"\] === true) { axios.get(blog\["若友人帐来自json文件，则地址为"\]).then( function (response) { blog\["友人帐"\] = response.data\["友人帐"\]; render\_friend\_book\_list(); }) } else { render\_friend\_book\_list(); } if ( (blog\["全局评论设置"\]\["启用valine评论"\] || blog\["全局评论设置"\]\["启用disqus评论"\] || blog\["全局评论设置"\]\["启用waline评论"\]) && blog\["友人帐页面允许评论"\] ) { document.querySelector( "#container" ).insertAdjacentHTML("beforeend", \`<div class="bbg-comment-area"><h3><i class="fa fa-comments-o"></i> 在友人帐中评论：</h3><br /><div id="vcomments"></div><div id="disqus\_thread"></div></div>\`); } render\_bottom\_information(); execute\_custom\_js(); if ( blog\["全局评论设置"\]\["启用valine评论"\] && blog\["友人帐页面允许评论"\] ) { new Valine({ el: "#vcomments", appId: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appid"\], appKey: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appkey"\], path: comment\_authcode + "internal=friendbook" }); preview\_env\_public\_comment\_fix(); } if (blog\["全局评论设置"\]\["启用disqus评论"\] && blog\["友人帐页面允许评论"\]) { let disqus\_config = function () { this.page.identifier = "friend\_book"; }; (function () { let d = document, s = d.createElement('script'); s.src = \`https://${blog\["全局评论设置"\]\["disqus设置"\]\["shortname"\]}.disqus.com/embed.js\`; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); } if ( blog\["全局评论设置"\]\["启用waline评论"\] && blog\["友人帐页面允许评论"\] ) { Waline.init({ el: "#vcomments", serverURL: blog\["全局评论设置"\]\["waline设置"\]\["serverurl"\], path: "internal=friendbook" }); } } function getTagTree() { let tagtree = new Object(); //todo:考虑隐藏文章不应该纳入到标签树中 for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["标签"\].length === 0) { } else { for (let k = 0; k < blog\["文章列表"\]\[i\]\["标签"\].length; k++) { if ( typeof tagtree\[blog\["文章列表"\]\[i\]\["标签"\]\[k\]\] === "undefined" ) { tagtree\[blog\["文章列表"\]\[i\]\["标签"\]\[k\]\] = new Array(); } else { } tagtree\[blog\["文章列表"\]\[i\]\["标签"\]\[k\]\].push(blog\["文章列表"\]\[i\]); } } } return tagtree; } function getTagTreeLength() { return Object.keys(getTagTree()).length; } function archive\_and\_tags\_switch\_to\_archive() { document.querySelector("#tag-content").setAttribute("style", "display:none"); document.querySelector("#archive-content").setAttribute("style", "display:block"); document.getElementById("archive\_and\_tags\_nav\_by\_tags").setAttribute("class", "nav-link archive-nav-link"); document.getElementById("archive\_and\_tags\_nav\_by\_time").setAttribute("class", "nav-link active archive-nav-link"); } function archive\_and\_tags\_switch\_to\_tags() { document.querySelector("#tag-content").setAttribute("style", "display:block"); document.querySelector("#archive-content").setAttribute("style", "display:none"); document.getElementById("archive\_and\_tags\_nav\_by\_tags").setAttribute("class", "nav-link active archive-nav-link"); document.getElementById("archive\_and\_tags\_nav\_by\_time").setAttribute("class", "nav-link archive-nav-link"); } function render\_tag\_tree() { //todo：考虑没有任何标签的情况 totalTagTreeArticleLength = 0; let tagtree = getTagTree(); document.getElementById("container").insertAdjacentHTML("beforeend", \`<br /><br /><ul class="nav nav-tabs archive-nav"> <li class="nav-item archive-nav-item"> <a class="nav-link active archive-nav-link" href="javascript:archive\_and\_tags\_switch\_to\_tags()" id="archive\_and\_tags\_nav\_by\_tags">按标签检索</a> </li> <li class="nav-item archive-nav-item"> <a class="nav-link archive-nav-link" href="javascript:archive\_and\_tags\_switch\_to\_archive()" id="archive\_and\_tags\_nav\_by\_time">按年份检索</a> </li> </ul><div class="tag-content" id="tag-content"></div><div class="tag-content" id="archive-content" style="display:none;"></div>\`); let archiveObj = new Object(); for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["是否隐藏"\] === false) { let year = new Date(blog\["文章列表"\]\[i\]\["创建时间（时间戳）"\]).getFullYear(); if (typeof archiveObj\[year\] === "undefined") { archiveObj\[year\] = new Array(); } archiveObj\[year\].push(i); } } for (let i = 0; i < Object.keys(archiveObj).length; i++) { document.querySelector( "#archive-content" ).insertAdjacentHTML("beforeend", \`<h2 id="archive-content-of-year-${Object.keys(archiveObj)\[i\]}"><i class="fa fa-calendar"></i> <span>${Object.keys(archiveObj)\[i\]}</span></h2>\`); for (let k = 0; k < archiveObj\[Object.keys(archiveObj)\[i\]\].length; k++) { document.querySelector( "#archive-content" ).insertAdjacentHTML("beforeend", \`<p><i class="fa fa-file-text-o"></i> <a href="./index.html?type=article&filename=${blog\["文章列表"\]\[archiveObj\[Object.keys(archiveObj)\[i\]\]\[k\]\]\["文件名"\]}" onclick="enter\_article(${archiveObj\[Object.keys(archiveObj)\[i\]\]\[k\]});return false;">${blog\["文章列表"\]\[archiveObj\[Object.keys(archiveObj)\[i\]\]\[k\]\]\["文章标题"\]}</a>（<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(blog\["文章列表"\]\[archiveObj\[Object.keys(archiveObj)\[i\]\]\[k\]\]\["创建时间（时间戳）"\])}，<i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(blog\["文章列表"\]\[archiveObj\[Object.keys(archiveObj)\[i\]\]\[k\]\]\["修改时间（时间戳）"\])}）</p>\`); } } document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 id="blog\_index\_title" style="font-size:50px;">${langdata\["ARCHIVE\_AND\_TAGS"\]\[lang\_name\]}</h1></div><br /><br /></div>\`); //分析标签树 for (let i = 0; i < getTagTreeLength(); i++) { // 遍历所有标签 // 渲染标签名字 document.querySelector( "#tag-content" ).insertAdjacentHTML("beforeend", \`<h2 id="tag-content-of-tag-${Object.keys(tagtree)\[i\]}"><i class="fa fa-tags"></i> <span style="color:${getTagColor(Object.keys(tagtree)\[i\])}">#${Object.keys(tagtree)\[i\]}</span></h2>\`); for (let k = 0; k < tagtree\[Object.keys(tagtree)\[i\]\].length; k++) { // 遍历某个标签中的所有文章 currentTagTreeArticleNumber = 0; for (let j = 0; j < blog\["文章列表"\].length; j++) { // 遍历index.json中的所有文章object，与标签中的文章object相比较， // 这是为了取得标签中的文章object在index.json中的文章列表array中对应的下标。 // 因为 enter\_article函数的参数是index.json中的文章列表array的下标，因此必须要获取到。 if (tagtree\[Object.keys(tagtree)\[i\]\]\[k\] === blog\["文章列表"\]\[j\] && blog\["文章列表"\]\[j\]\["是否隐藏"\] === false) { document.querySelector( "#tag-content" ).insertAdjacentHTML("beforeend", \`<p><i class="fa fa-file-text-o"></i> <a href="./index.html?type=article&filename=${blog\["文章列表"\]\[j\]\["文件名"\]}" onclick="enter\_article(${j});return false;">${tagtree\[Object.keys(tagtree)\[i\]\]\[k\]\["文章标题"\]}</a>（<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(tagtree\[Object.keys(tagtree)\[i\]\]\[k\]\["创建时间（时间戳）"\])}，<i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(tagtree\[Object.keys(tagtree)\[i\]\]\[k\]\["修改时间（时间戳）"\])}）</p>\`); currentTagTreeArticleNumber++; } totalTagTreeArticleLength = totalTagTreeArticleLength + 1; } if (currentTagTreeArticleNumber === 0) { document.getElementById(\`tag-content-of-tag-${Object.keys(tagtree)\[i\]}\`).setAttribute("style", "display:none"); } } } if (getTagTreeLength() === 0) { document.querySelector("#tag-content").insertAdjacentHTML("beforeend", \`<h3><i class="fa fa-tags"></i> 未分类文章</h3>\`); for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["是否隐藏"\] === false) { document.querySelector("#tag-content").insertAdjacentHTML("beforeend", \`<p><i class="fa fa-file-text-o"></i> <a href="./index.html?type=article&filename=${blog\["文章列表"\]\[i\]\["文件名"\]}">${blog\["文章列表"\]\[i\]\["文章标题"\]}</a>（<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(blog\["文章列表"\]\[i\]\["创建时间（时间戳）"\])}，<i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]}${blog\["文章列表"\]\[i\]\["修改日期"\]}）</p>\`); } } } else { if (totalTagTreeArticleLength < blog\["文章列表"\].length) { document.getElementById("tag-content").insertAdjacentHTML("beforeend", \`<h3><i class="fa fa-tags"></i> 未分类文章</h3>\`); for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["是否隐藏"\] === false) { if (blog\["文章列表"\]\[i\]\["标签"\].length === 0 || blog\["文章列表"\]\[i\]\["标签"\] === false || blog\["文章列表"\]\[i\]\["标签"\] === "" || blog\["文章列表"\]\[i\]\["标签"\] === undefined || blog\["文章列表"\]\[i\]\["标签"\] === null) { document.querySelector("#tag-content").insertAdjacentHTML("beforeend", \`<p><i class="fa fa-file-text-o"></i> <a href="./index.html?type=article&filename=${blog\["文章列表"\]\[i\]\["文件名"\]}">${blog\["文章列表"\]\[i\]\["文章标题"\]}</a>（<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(blog\["文章列表"\]\[i\]\["创建时间（时间戳）"\])}，<i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]}${blog\["文章列表"\]\[i\]\["修改日期"\]}）</p>\`); } } } } } } function render\_tag(tagname) { document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 style="font-size:50px;"<i class="fa fa-tags"></i> 标签为 <span style="color:${getTagColor(tagname)}">#${tagname}</span> 下的文章</h1></div><br /><br /></div>\`); document.getElementById("container").insertAdjacentHTML("beforeend", \`<div class="tag-content" id="tag-content"></div>\`); let tagtree = getTagTree(); for (let i = 0; i < tagtree\[tagname\].length; i++) { for (let j = 0; j < blog\["文章列表"\].length; j++) { if (tagtree\[tagname\]\[i\] === blog\["文章列表"\]\[j\] && blog\["文章列表"\]\[j\]\["是否隐藏"\] === false) { document.querySelector( "#tag-content" ).insertAdjacentHTML("beforeend", \`<p><i class="fa fa-file-text-o"></i> <a href="/index.html?type=article&filename=${blog\["文章列表"\]\[j\]\["文件名"\]}" onclick="enter\_article(${j});return false;">${tagtree\[tagname\]\[i\]\["文章标题"\]}</a>（<i class="fa fa-calendar"></i> ${langdata\["ARTICLE\_CREATEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(tagtree\[tagname\]\[i\]\["创建时间（时间戳）"\])}，<i class="fa fa-clock-o"></i> ${langdata\["LASTMODIFIEDAT"\]\[lang\_name\]}${convertTimeStampToLocalTime(tagtree\[tagname\]\[i\]\["修改时间（时间戳）"\])}）</p>\`); } } } } function render\_page(page\_id) { if (blog\["Markdown渲染配置"\]\["使用markdown文件所在目录作为baseurl"\]) { baseurl = "/data/pages/" } if (blog\["启用网站公告"\] === true && blog\["网站公告仅在首页显示"\] === false) { document.querySelector("#container").insertAdjacentHTML("beforeend", \`<div class="alert alert-primary"><i class="fa fa-bullhorn" aria-hidden="true"></i> 公告： ${blog\["网站公告"\]}</div>\`) } document.querySelector( "#root" ).insertAdjacentHTML("afterbegin", \`<div class="bg-light"><br /><br /><br /><br /><div class="container blog\_title\_jumbotron"><h1 style="font-size:50px;">${blog\["页面列表"\]\[page\_id\]\["页面标题"\]}</h1></div><br /><br /></div>\`); document.querySelector( "#container" ).insertAdjacentHTML("beforeend", \`<div class="page-content" id="page-content"></div>\`) axios .get( "./data/pages/" + blog\["页面列表"\]\[page\_id\]\["文件名"\] + "?timestamp=" + Date.parse(new Date()) ) .then(function (response) { document.querySelector("#page-content").insertAdjacentHTML("beforeend", \`<div id="page-content-html">${marked.parse(response.data)}</div>\`); if (blog\["不使用全站内容授权协议"\] === false) { document.getElementById("page-content").insertAdjacentHTML("beforeend", \`<br /><div class="copyright\_hint"><h5>${langdata.COPYRIGHT\_HINT\[lang\_name\]}</h5><p class="mb-0">${blogContentLicenseText}</p></div>\`); } // 评论 if ( (blog\["全局评论设置"\]\["启用valine评论"\] || blog\["全局评论设置"\]\["启用disqus评论"\] || blog\["全局评论设置"\]\["启用waline评论"\]) && blog\["页面列表"\]\[page\_id\]\["启用评论"\] ) { document.querySelector( "#container" ).insertAdjacentHTML("beforeend", \`<div class="bbg-comment-area"><h3><i class="fa fa-comments-o"></i> 在此页面 《${blog\["页面列表"\]\[page\_id\]\["页面标题"\]}》 下评论：</h3><br /><div id="vcomments"></div><div id="disqus\_thread"></div></div>\`); } render\_bottom\_information(); execute\_custom\_js(); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); if ( blog\["全局评论设置"\]\["启用valine评论"\] && blog\["页面列表"\]\[page\_id\]\["启用评论"\] ) { new Valine({ el: "#vcomments", appId: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appid"\], appKey: blog\["全局评论设置"\]\["valine设置"\]\["leancloud\_appkey"\], path: comment\_authcode + "page=" + blog\["页面列表"\]\[page\_id\]\["文件名"\], }); preview\_env\_public\_comment\_fix(); } if (blog\["全局评论设置"\]\["启用disqus评论"\] && blog\["页面列表"\]\[page\_id\]\["启用评论"\]) { let disqus\_config = function () { this.page.identifier = "page=" + blog\["页面列表"\]\[page\_id\]\["文件名"\]; }; (function () { let d = document, s = d.createElement('script'); s.src = \`https://${blog\["全局评论设置"\]\["disqus设置"\]\["shortname"\]}.disqus.com/embed.js\`; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); } if ( blog\["全局评论设置"\]\["启用waline评论"\] && blog\["页面列表"\]\[page\_id\]\["启用评论"\] ) { Waline.init({ el: "#vcomments", serverURL: blog\["全局评论设置"\]\["waline设置"\]\["serverurl"\], path: "page=" + blog\["页面列表"\]\[page\_id\]\["文件名"\], }); } }); } function enter\_page(page\_id) { history.pushState({ type: "page", filename: blog\["页面列表"\]\[page\_id\]\["文件名"\] }, "", \`./index.html?type=page&filename=${blog\["页面列表"\]\[page\_id\]\["文件名"\]}\`); if (blog\["页面列表"\]\[page\_id\]\["是否在新标签页打开"\]) { if (blog\["页面列表"\]\[page\_id\]\["这是一个完整的html"\]) { // 在新标签页打开，是完整的html window.open("./data/pages/" + blog\["页面列表"\]\[page\_id\]\["文件名"\]); } else { //在新标签页打开，是markdown window.open("./index.html?page\_id=" + page\_id); } } else { if (blog\["页面列表"\]\[page\_id\]\["这是一个完整的html"\]) { // 当前标签页打开，是完整的html window.location.href = "./data/pages/" + blog\["页面列表"\]\[page\_id\]\["文件名"\]; } else { // 当前标签页打开，是markdown document.getElementsByTagName("title")\[0\].innerHTML = \`${blog\["页面列表"\]\[page\_id\]\["页面标题"\]} - ${blog\["博客标题"\]} \`; resetPage(); render\_nav(false); render\_container(); render\_page(page\_id); document.getElementById(\`navbar\_page\_${page\_id}\`).classList.add("nav-item-active"); } } } function render\_bottom\_information() { document.getElementById("container").insertAdjacentHTML("beforeend", \`<hr /><div style="color:grey" id="bottom\_info\_html">${marked.parse(blog\["底部信息（格式为markdown）"\])}</div>\`); } function execute\_custom\_js() { if (blog\["启用自定义JS"\] === true) { eval(blog\["自定义JS"\]); } if (blog\["是否启用插件功能"\] === true) { for (const pluginObj of blog\["插件列表"\]) { if (pluginObj\["是否启用此插件"\] === true) { console.log(\`\[插件加载开始\] 开始加载插件${pluginObj\["插件名称"\]}, 插件版本${pluginObj\["插件版本"\]}, 插件作者${pluginObj\["插件作者名"\]} <${pluginObj\["插件作者url"\]}>\`) eval(pluginObj\["插件内容"\]); console.log(\`\[插件加载结束\] 已加载插件${pluginObj\["插件名称"\]}\`); } } } } function enter\_tag(tagname) { history.pushState({ type: "internal", function: "tag", argument: decodeURIComponent(tagname) }, "", \`./index.html?type=internal&function=tag&argument=${tagname}\`); document.getElementsByTagName("title")\[0\].innerHTML = \`标签为 ${decodeURIComponent(tagname)} 下的文章 - ${blog\["博客标题"\]} \`; resetPage(); render\_nav(false); render\_container(); render\_tag(decodeURIComponent(tagname)); render\_bottom\_information(); document.getElementById("navbar\_archive\_and\_tags").classList.add("nav-item-active"); execute\_custom\_js(); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); setTimeout(() => { scrollTo(0, 0); }, 1); } function enter\_friend\_book() { history.pushState({ type: "internal", function: "friendbook" }, "", \`./index.html?type=internal&function=friendbook\`); document.getElementsByTagName("title")\[0\].innerHTML = \`友人帐 - ${blog\["博客标题"\]} \`; resetPage(); render\_nav(false); render\_container(); render\_friend\_book(); document.getElementById("navbar\_friendbook").classList.add("nav-item-active"); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); setTimeout(() => { scrollTo(0, 0); }, 1); } function enter\_archive\_and\_tags() { history.pushState({ type: "internal", function: "archive\_and\_tags" }, "", \`./index.html?type=internal&function=archive\_and\_tags\`); document.getElementsByTagName("title")\[0\].innerHTML = \`归档与标签 - ${blog\["博客标题"\]} \`; resetPage(); render\_nav(false); render\_container(); render\_tag\_tree(); render\_bottom\_information(); document.getElementById("navbar\_archive\_and\_tags").classList.add("nav-item-active"); execute\_custom\_js(); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); setTimeout(() => { scrollTo(0, 0); }, 1); } function enter\_indexPage() { history.pushState({ type: "internal", function: "article\_list" }, "", \`./index.html?type=internal&function=article\_list\`); document.getElementsByTagName("title")\[0\].innerHTML = blog\["博客标题"\]; resetPage(); render\_nav(true); render\_container(); render\_index\_title\_info(); render\_article\_list(); render\_bottom\_information(); document.getElementById("navbar\_article\_list").classList.add("nav-item-active"); execute\_custom\_js(); content\_load\_finished = true; detect\_whether\_ui\_load\_finished(); // firefox下这里如果不用setTimeout直接执行scrollTo可能会导致无法滚动 setTimeout(() => { scrollTo(0, 0); }, 1); } function enter\_article(article\_id, visible = false) { let article\_list = blog\["文章列表"\]; if (visible) blog\["文章列表"\] = visible\_articles; history.pushState({ type: "article", filename: blog\["文章列表"\]\[article\_id\]\["文件名"\] }, "", \`./index.html?type=article&filename=${blog\["文章列表"\]\[article\_id\]\["文件名"\]}\`); document.getElementsByTagName("title")\[0\].innerHTML = \`${blog\["文章列表"\]\[article\_id\]\["文章标题"\]} - ${blog\["博客标题"\]} \`; resetPage(); render\_nav(false); render\_container(); render\_article\_content(article\_id, visible); blog\["文章列表"\] = article\_list; setTimeout(() => { scrollTo(0, 0); }, 1); } function getUrlArgs(variable) { var query = window.location.search.substring(1); var vars = query.split("&"); for (var i = 0; i < vars.length; i++) { var pair = vars\[i\].split("="); if (pair\[0\] == variable) { return pair\[1\]; } } return false; } function importBootstrapCSSFile(uri) { axios .get(uri) .then(function (response) { document.getElementById("bootstrap\_css").insertAdjacentHTML("beforeend", response.data); bootstrap\_css\_import\_finished = true; detect\_whether\_ui\_load\_finished(); }) } function importHighlightCSSFile(uri) { axios .get(uri) .then(function (response) { document.getElementById("highlight\_css").insertAdjacentHTML("beforeend", response.data); }) } function switch\_night\_mode(mode) { // https://developer.mozilla.org/zh-CN/docs/Web/API/StyleSheet/disabled const darkModeElement = document.getElementById("dark\_mode"); switch (mode) { case "light": darkModeElement.disabled = true; break; case "dark": darkModeElement.disabled = false; break; default: darkModeElement.disabled = !darkModeElement.disabled; } } axios .get("./data/index.json?timestamp=" + Date.parse(new Date())) .then(function (response) { blog = response.data; lang\_name = blog\["网站语言"\]; reload\_dark\_mode\_setting(); if (typeof(blog\["站点主题"\])!=="undefined"){ if(blog\["站点主题"\] === "Solarized\_Pink"){ blog\["全局主题设置"\]\["标题栏背景颜色"\] = "#6699cc"; blog\["全局主题设置"\]\["链接颜色"\] = "#993366"; document.querySelector("#theme\_css").innerHTML = \` .bg-light { background-color: #fffff240!important; border-bottom: 1px solid #6699cc; margin-bottom: 35px } body { background-color:#ffffe2; } .article-item, .article-content, .page-content, .articlebottomnav, .tag-content, .bbg-comment-area { border: 1px solid #874342; background: #fffff2a0; box-shadow: none; } #blog\_index\_title, #current\_article\_title, .blog\_title\_jumbotron h1 { color: #206c89; } code, pre { background-color: #ffffe0; color: #993366; border-radius: 8px; } \`; } } switch (blog\["全站内容授权协议"\]) { case "reserved": blogContentLicenseText = \`${langdata.COPYRIGHT\_RESERVED\[lang\_name\]}\` break; case "unlicensed": blogContentLicenseText = \`${langdata.COPYRIGHT\_UNLICENSED\[lang\_name\]}\` break; case "cc-by-nc-sa-4.0": blogContentLicenseText = \`${langdata.COPYRIGHT\_CC\_BY\_NC\_SA\_FOUR\_DOT\_ZERO\[lang\_name\]}\` break; default: blogContentLicenseText = \`${blog\["全站内容授权协议"\]}\`; } if (blog\["自定义界面文本"\]\["启用"\]) { for (let i = 0; i < blog\["自定义界面文本"\]\["列表"\].length; i++) { langdata\[blog\["自定义界面文本"\]\["列表"\]\[i\]\["key"\]\]\[blog\["网站语言"\]\] = blog\["自定义界面文本"\]\["列表"\]\[i\]\["value"\]; } } if (blog\["Markdown渲染配置"\]\["根据用户屏幕尺寸渲染图片尺寸"\] && blog\["Markdown渲染配置"\]\["在用户点击图片时显示图片查看器"\]) { markdown\_renderer.image = function (src, title, alt) { return \`<img style="max-width:100%;max-height:400px; border-style:solid; border-width: 2px; border-color: #66ccff; border-radius: 6px" onclick="openImageViewer('${src}')" src="${src.indexOf("https://") === -1 && src.indexOf("http://") === -1 ? baseurl : ""}${src}" alt="${alt}" title="${title ? title : ''}" /> \` } marked.setOptions({ renderer: markdown\_renderer, highlight: highlightFunc }); } else if (blog\["Markdown渲染配置"\]\["根据用户屏幕尺寸渲染图片尺寸"\] === true && blog\["Markdown渲染配置"\]\["在用户点击图片时显示图片查看器"\] === false) { markdown\_renderer.image = function (src, title, alt) { return \`<img style="max-width:100%;max-height:400px; border-style:solid; border-width: 2px; border-color: #66ccff; border-radius: 6px" src="${src.indexOf("https://") === -1 && src.indexOf("http://") === -1 ? baseurl : ""}${src}" alt="${alt}" title="${title ? title : ''}" /> \` } marked.setOptions({ renderer: markdown\_renderer, highlight: highlightFunc }); } else if (blog\["Markdown渲染配置"\]\["根据用户屏幕尺寸渲染图片尺寸"\] === false && blog\["Markdown渲染配置"\]\["在用户点击图片时显示图片查看器"\] === true) { markdown\_renderer.image = function (src, title, alt) { return \`<img onclick="openImageViewer('${src}')" src="${src.indexOf("https://") === -1 && src.indexOf("http://") === -1 ? baseurl : ""}${src}" alt="${alt}" title="${title ? title : ''}" /> \` } marked.setOptions({ renderer: markdown\_renderer, highlight: highlightFunc }); } else if (blog\["Markdown渲染配置"\]\["使用markdown文件所在目录作为baseurl"\]) { markdown\_renderer.image = function (src, title, alt) { return \`<img src="${src.indexOf("https://") === -1 && src.indexOf("http://") === -1 ? baseurl : ""}${src}" alt="${alt}" title="${title ? title : ''}" /> \` } marked.setOptions({ renderer: markdown\_renderer, highlight: highlightFunc }); } if (blog\["使版心宽度更窄（提高左右页边距）"\]) { document.getElementById("theme\_settings").insertAdjacentHTML("beforeend", \`@media(min-width: 1000px){.container{padding-left: 12%;padding-right: 12%;padding-top: 0;padding-bottom: 0}#blog\_title\_jumbotron {padding-left: 12%;padding-right: 12%;}}\`); } if (blog\["优先使用衬线字体"\]) { document.getElementById("theme\_settings").insertAdjacentHTML("beforeend", \`\* {font-family: 'Noto Serif SC','Source Han Serif SC','Source Han Serif',source-han-serif-sc,'PT Serif','SongTi SC',serif;}\`); } if (blog\["全局主题设置"\]\["禁用导航栏的阴影效果"\]) { document.getElementById("theme\_settings").insertAdjacentHTML("beforeend", \`nav {opacity: 0.9;box-shadow: none;padding: 0 !important;}\`); } let cdn\_path = blog\["CDN路径"\]; // js importing disabled due to execution order is inevitable, while css importing can safely operate. importBootstrapCSSFile(cdn\_path + "/bootstrap@5.0.2/dist/css/bootstrap.min.css"); importHighlightCSSFile(cdn\_path + "/highlight.js@9.12.0/styles/tomorrow.css"); // 总之先这么用着……之后有更好的写法再说吧 visible\_articles = blog\["文章列表"\].filter(a => !a\["是否隐藏"\]); articleListPageLength = Math.ceil(visible\_articles.length / blog\["文章列表中每页的文章数为"\]); // 从1开始数 if (blog\["全局评论设置"\]\["valine设置"\]\["是否使用bbg公共评论服务"\]) { if (window.location.href.indexOf("?") === -1) { comment\_authcode = \`domain=${window.location.href .replaceAll("#top", "") .replaceAll("index.html", "") .replaceAll("#", "")};\`; } if (window.location.href.indexOf("?") !== -1) { comment\_authcode = \`domain=${window.location.href .replaceAll("#top", "") .replaceAll("index.html", "") .replaceAll("#", "") .replaceAll("type=article", "") .replaceAll("type=page", "") .replaceAll("?", "") .replaceAll("&", "") .replaceAll("filename=", "") .replaceAll(getUrlArgs("filename"), "")};\`; } } else { comment\_authcode = ""; } // 网页背景载入 if (blog\["全局主题设置"\]\["是否使用纯色背景（优先级高于背景图像）"\]) { document.querySelector("#blogcss").insertAdjacentHTML("beforeend", \`body:before{background: ${blog\["全局主题设置"\]\["若使用纯色背景，颜色为"\]};}\`); } else if (blog\["全局主题设置"\]\["是否使用背景图像"\]) { if (blog\["全局主题设置"\]\["若使用背景图像，设置为"\]\["将网站根目录下的background.webp作为背景图像"\]) { document.querySelector("#blogcss").insertAdjacentHTML("beforeend", \`body:before{background: url(./background.webp) center/cover;}\`); } else if ( blog\["全局主题设置"\]\["若使用背景图像，设置为"\]\[ "将某个url作为背景图像" \] ) { document.querySelector("#blogcss").insertAdjacentHTML("beforeend", \`body:before{background: url(${blog\["全局主题设置"\]\["若使用背景图像，设置为"\]\["若将某个url作为背景图像，这个url是"\]}) center/cover;}\`); } } // css for .nav-item function hexToRgbInNavItemCss(hex) { hex = hex.replace(/^#/, '').trim(); const r = parseInt(hex.slice(0, 2), 16); const g = parseInt(hex.slice(2, 4), 16); const b = parseInt(hex.slice(4, 6), 16); return \`rgb(${r}, ${g}, ${b})\`; } function rgbAdjustmentInNavItemCss(rgb) { const rgbString = rgb; const rgbArray = rgbString.match(/\\d+/g); let \[r, g, b\] = rgbArray; r = parseInt(r); g = parseInt(g); b = parseInt(b); if (r + 30 < 255) { r += 30; } else { r = 255; } if (b + 30 < 255) { b += 30; } else { b = 255; } if (g + 30 < 255) { g += 30; } else { g = 255; } return \`rgb(${r}, ${g}, ${b})\`; } function processed\_color\_for\_nav\_item\_hover\_css(color) { if (color.includes("rgb") === true && color.includes("rgba") === false) { // is rgb color return rgbAdjustmentInNavItemCss(color); } else if (color.includes("#") === true) { // is hex color return rgbAdjustmentInNavItemCss(hexToRgbInNavItemCss(color)); } else { // unable to detect color type return color; } } document.getElementById("blogcss").insertAdjacentHTML("beforeend", \`.nav-item {background-color:${blog\["全局主题设置"\]\["标题栏背景颜色"\]}}.nav-item:hover{background-color:${processed\_color\_for\_nav\_item\_hover\_css(blog\["全局主题设置"\]\["标题栏背景颜色"\])};transition: background-color 0.1s;}\`); // load custom link color document.getElementById("blogcss").insertAdjacentHTML("beforeend", \`a{color:${blog\["全局主题设置"\]\["链接颜色"\]}}a:hover{color:${processed\_color\_for\_nav\_item\_hover\_css(blog\["全局主题设置"\]\["链接颜色"\])}}a:active{${processed\_color\_for\_nav\_item\_hover\_css(blog\["全局主题设置"\]\["链接颜色"\])}}.underline-animation {position: relative;text-decoration: none;}.underline-animation::before {content: "";position: absolute;display: block;width: 100%;height: 2px;bottom: 0;left: 0;background-color: ${blog\["全局主题设置"\]\["链接颜色"\]};transform: scaleX(0);transition: transform 0.3s ease;}.underline-animation:hover::before{transform: scaleX(1);}\`); function live2d\_res\_load(url, type) { return new Promise((resolve, reject) => { let tag; switch(type){ case "js": tag = document.createElement("script"); tag.src = url; tag.type = "text/javascript"; break; case "css": tag = document.createElement("link"); tag.rel = "stylesheet"; tag.href = url; break; } if (tag) { tag.onload = () => resolve(url); tag.onerror = () => reject(url); document.head.appendChild(tag); } }); } const live2d\_enabled = blog\["全局主题设置"\]\["是否启用live2d-widget"\]; if (live2d\_enabled === true) { const live2d\_path = blog\["全局主题设置"\]\["live2d-widget设置"\]\["widget路径"\]; const live2d\_tips\_path = blog\["全局主题设置"\]\["live2d-widget设置"\]\["tips路径"\]; const live2d\_api\_path = blog\["全局主题设置"\]\["live2d-widget设置"\]\["api路径"\]; let live2d\_tools = \[\]; for(let live2d\_tool of Object.keys(blog\["全局主题设置"\]\["live2d-widget设置"\]\["功能设置"\])){ if(blog\["全局主题设置"\]\["live2d-widget设置"\]\["功能设置"\]\[live2d\_tool\] === true){ live2d\_tools.push(live2d\_tool); } } if(screen.width >= 768){ Promise.all(\[ live2d\_res\_load(\`${live2d\_path}waifu.css\`, "css"), live2d\_res\_load(\`${live2d\_path}live2d.min.js\`, "js"), live2d\_res\_load(\`${live2d\_path}waifu-tips.js\`, "js") \]).then(()=>{ initWidget({ waifuPath: live2d\_tips\_path, cdnPath: live2d\_api\_path, tools: live2d\_tools }); }); } } // 自定义css载入 if (blog\["启用自定义CSS"\] === true) { document.getElementById("custom\_css").innerHTML = blog\["自定义CSS"\]; } if (getUrlArgs("type") === "article") { let article\_filename = getUrlArgs("filename"); for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["文件名"\] === article\_filename) { success\_locate\_article\_id = true; enter\_article(i); } } if (success\_locate\_article\_id !== true) { document.getElementById("root").setAttribute("style", ""); document.getElementById("loading").setAttribute("style", "display:none;"); document.getElementById("root").innerHTML = \`<div style="text-align:center"><br /><h3>此文章不存在或已被删除</h3><p>This article does not exist or has already been deleted.</p></div>\`; } } if (getUrlArgs("type") === "short\_article") { let article\_id = getUrlArgs("id"); for (let i = 0; i < blog\["文章列表"\].length; i++) { if (blog\["文章列表"\]\[i\]\["标识符"\] === article\_id) { success\_locate\_article\_id = true; enter\_article(i); } } if (success\_locate\_article\_id !== true) { document.getElementById("root").setAttribute("style", ""); document.getElementById("loading").setAttribute("style", "display:none;"); document.getElementById("root").innerHTML = \`<div style="text-align:center"><br /><h3>此文章不存在或已被删除</h3><p>This article does not exist or has already been deleted.</p></div>\`; } } if (getUrlArgs("type") === "page") { let page\_filename = getUrlArgs("filename"); for (let i = 0; i < blog\["页面列表"\].length; i++) { if (blog\["页面列表"\]\[i\]\["文件名"\] === page\_filename) { success\_locate\_page\_id = true; enter\_page(i); } } if (success\_locate\_page\_id !== true) { document.getElementById("root").setAttribute("style", ""); document.getElementById("loading").setAttribute("style", "display:none;"); document.getElementById("root").innerHTML = \`<div style="text-align:center"><br /><h3>此页面不存在或已被删除</h3><p>This page does not exist or has already been deleted.</p></div>\`; } } if (getUrlArgs("type") === "internal") { let internal\_function = getUrlArgs("function"); let internal\_function\_argument = getUrlArgs("argument"); if (internal\_function === "article\_list") { enter\_indexPage(); } if (internal\_function === "archive\_and\_tags") { enter\_archive\_and\_tags(); } if (internal\_function === "tag") { enter\_tag(internal\_function\_argument); } if (internal\_function === "friendbook") { enter\_friend\_book(); } } if (getUrlArgs("type") === false) { enter\_indexPage(); } });